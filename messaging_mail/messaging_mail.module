<?php
/**
 * @file
 * Simple mail using Drupal API. Messaging method plug-in
 */

/**
 * Implementation of hook_messaging
 */
function messaging_mail_messaging($op = 'info') {
  switch($op) {
    case 'send methods':
      $info['mail'] = array(
        'name' => t('Mail'), // Name for display
        'destination' => 'mail', // Account property to use as destination
        'send' => 'messaging_mail_send', // Sending callback
        'type' => MESSAGING_TYPE_PUSH,  // Method type: push || pull
        'glue' => "\n", // Glue for message body lines
        'footer' => "\n--",  // Separator for message footer
      );
      return $info;  
  }
}

/**
 * Send mail message to user account
 * 
 * @param $destination
 *   Array of e-mails
 * @param $message
 *   Message array
 */
function messaging_mail_send($destination, $message) {
  $mailkey = 'message-'.$message['type'];
  $count = 0;
  foreach ($destination as $to) {
    $count += drupal_mail($mailkey, $to, $message['subject'], $message['body']) ? 1 : 0;
  }
  return $count;
}
 