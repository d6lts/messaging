<?php
/**
 * @file
 * Simple mail using Drupal API. Messaging method plug-in
 * 
 * @ TO DO Review filtering
 */

/**
 * Implementation of hook_messaging
 */
function messaging_private_messaging($op) {
  switch($op) {
    case 'send methods':
      $info['privatemsg'] = array(
        'name' => t('Privatemsg'),
        'send' => 'messaging_private_send',
        'type' => MESSAGING_TYPE_PUSH,
        'access' => 'access private messages',
        'glue' => "\n",
        'description' => t('Send messages through Privatemsg'),
      );
      return $info;  
  }
}

/**
 * Send mail message to user accounts
 * 
 * @param $destination
 *   Array of user accounts
 */
function messaging_private_send($destination, $message) {
  // Hand over to privatemsg  
  foreach ($destination as $account) {
    privatemsg_send_privatemsg($account, $message['subject'], $message['body']);
  }
  // @ TO DO How to check for success?
  return count($destination);
}
 